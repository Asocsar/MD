?MCA
??MCA
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
# Clear plots
if(!is.null(dev.list())) dev.off()
# Clean workspace
rm(list=ls())
#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
setwd("~/Desktop/ADEI/Labs/DeliverableII")
df <- read.table("Deliverable1.csv",header=T, sep=",");
vars_dis <- c("VendorID", "Payment_type", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date", "multiouts", "f.espeed", "f.tlenkm", "f.traveltime", "f.distHaversine", "AnyToll", "f.Fare_amount", "f.Passenger_count", "f.Total_amount")
vars_con <- c( "Passenger_count", "tlenkm", "Pickup_longitude", "Pickup_latitude", "Dropoff_longitude", "Dropoff_latitude","Fare_amount", "espeed", "Tip_amount", "Tolls_amount", "lpep_pickup_time", "traveltime", "distHaversine")
for( i in vars_dis){
df[,i] <- as.factor(df[,i])
}
vars_res <- c("AnyTip", "Total_amount")
d1 <- dim(df)[1]
d2 <- dim(df)[2]
df[,d2-1] <- as.factor(df[,d2-1])
res.pca<-PCA(df[,c(1:10,20:(d2-2),d2)],quali.sup=c(1:10),quanti.sup=c(13:16,24), ncp=4, ind.sup = which(df$multiouts==TRUE))
summary(res.pca,nb.dec=2,nbind=1,nbelements=1000,ncp=4)
fviz_eig(res.pca, choice = "eigenvalue", addlabels = TRUE)
fviz_eig(res.pca, addlabels = TRUE)
corrplot(res.pca$var$cos2, is.corr=FALSE)
fviz_cos2(res.pca, choice = "var", axes = 1:2, top = 10)
fviz_cos2(res.pca, choice = "var", axes = 3:4, top = 10)
fviz_cos2(res.pca, choice = "ind", axes = 1:2, top = 10)
fviz_cos2(res.pca, choice = "ind", axes = 3:4, top = 10)
corrplot(res.pca$var$contrib, is.corr=FALSE)
fviz_contrib(res.pca, choice = "var", axes = 1:2, top = 10)
fviz_contrib(res.pca, choice = "var", axes = 3:4, top = 10)
fviz_contrib(res.pca, choice = "ind", axes = 1:2, top = 10)
fviz_contrib(res.pca, choice = "ind", axes = 3:4, top = 10)
plot.PCA(res.pca,choix=c("var"), axes=c(1,2))
plot.PCA(res.pca,choix=c("var"), axes=c(3,4))
corrplot(res.pca$var$coord, is.corr=FALSE)
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"), axes=c(1,2))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"), axes=c(3,4))
corrplot(res.pca$quanti.sup$coord, is.corr=FALSE)
plot.PCA(res.pca,choix=c("var"),invisible=c("var"), axes=c(1,2))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"), axes=c(3,4))
plot.PCA(res.pca,choix=c("ind"), invisible = c("ind", "ind.sup"), axes=c(1,2))
plot.PCA(res.pca,choix=c("ind"), invisible = c("ind", "ind.sup"), axes=c(3,4))
plot(res.pca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(1,2))
plot(res.pca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(3,4))
plot(res.pca,choix=c("ind"),invisible = c("ind", "var", "quali"), axes=c(1,2))
plot(res.pca,choix=c("ind"),invisible = c("ind", "var", "quali"), axes=c(3,4))
res.pca<-PCA(df[,c(1:10,20:(d2-2),d2)],quali.sup=c(1:10),quanti.sup=c(13:16,24), ncp=4, graph= FALSE)
res.hcpc<-HCPC(res.pca,nb.clust = -1,order=TRUE)
df$hcpck<-res.hcpc$data.clust$clust
barplot(table(res.hcpc$data.clust$clust))
summary(res.hcpc$data.clust$clust)
res.hcpc$desc.var$test.chi2
res.hcpc$desc.var$category
res.hcpc$desc.var$quanti.var
res.hcpc$desc.var$quanti
res.hcpc$desc.axes$quanti.var
res.hcpc$desc.axes$quanti
res.hcpc$desc.ind$para
res.hcpc$desc.ind$dist
para1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[1]]))
para2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[2]]))
para3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[3]]))
para4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[4]]))
para5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[5]]))
para6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[6]]))
dist1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[1]]))
dist2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[2]]))
dist3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[3]]))
dist4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[4]]))
dist5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[5]]))
dist6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[6]]))
plot(res.pca,label="none",invisible=c("quali","ind.sup"))
plot(res.pca$ind$coord[,1],res.pca$ind$coord[,2],col="grey80",cex=0.5,pch=16)
points(res.pca$ind$coord[para1,1],res.pca$ind$coord[para1,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist1,1],res.pca$ind$coord[dist1,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para2,1],res.pca$ind$coord[para2,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist2,1],res.pca$ind$coord[dist2,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para3,1],res.pca$ind$coord[para3,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist3,1],res.pca$ind$coord[dist3,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para4,1],res.pca$ind$coord[para4,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist4,1],res.pca$ind$coord[dist4,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para5,1],res.pca$ind$coord[para5,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist5,1],res.pca$ind$coord[dist5,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para6,1],res.pca$ind$coord[para6,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist6,1],res.pca$ind$coord[dist6,2],col="orange",cex=2,pch=16)
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[2]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[2]])),]
res.hcpc$call$t$nb.clust
res.hcpc$call$t$within[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$quot[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$inert.gain[1:res.hcpc$call$t$nb.clust]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[res.hcpc$call$t$nb.clust])/res.hcpc$call$t$within[1]
res.pca<-PCA(df[,c(1:10,20:(d2-2),d2)],quali.sup=c(1:10),quanti.sup=c(13:16,24), ncp=4, graph= FALSE)
ppcc<-res.pca$ind$coord[,1:4]
dist<-dist(ppcc)
kc<-kmeans(dist,6, iter.max = 30, trace=T)
df$claKM<-factor(kc$cluster)
kc$betweenss/kc$totss
i <- which(names(df)=="claKM")
res.cat<-catdes(df,i)
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
df$hcpck<-factor(df$hcpck,labels=paste("kHP-",1:6))
df$claKM<-factor(df$claKM,levels=c(3,6,2,1,5,4),labels=c("kKM-3","kKM-6","kKM-2","kKM-1","kKM-5","kKM-4"))
tt<-table(df$hcpck,df$claKM)
tt
sum(diag(tt)/sum(tt))
tt<-table(df[,c("f.Total_amount","lpep_pickup_period")])
tt
chisq.test(tt)
res.ca<-CA(tt)
#lines(res.ca$row$coord[,1],res.ca$row$coord[,2],lwd=2,col="blue")
summary(res.ca,dig=2)
names(res.ca)
fviz_eig(res.ca)
fviz_ca_biplot(res.ca,repel=TRUE)+theme_bw()
tt<-table(df[,c("f.Total_amount","f.traveltime")])
tt
chisq.test(tt)
res.ca<-CA(tt)
plot(res.ca$row$coord[,1],res.ca$row$coord[,2],pch=19,col="blue",xlim=c(-1,3),ylim=c(-1,3),xlab="Axis 1",ylab="Axis 2",main="CA f.traveltime vs f.Total_amount")
points(res.ca$col$coord[,1],res.ca$col$coord[,2],pch=19,lwd=2,col="red")
#text(res.ca$row$coord[c(1,7,2,3,4,5,6),1],res.ca$row$coord[c(1,7,2,3,4,5,6),2],col="blue",labels=levels(df$f.traveltime))
#text(res.ca$col$coord[c(3,1,2),1],res.ca$col$coord[c(3,1,2),2],col="red",labels=levels(df$f.Total_amount))
lines(res.ca$row$coord[c(1,7,2:6),1],res.ca$row$coord[c(1,7,2:6),2],lwd=2,col="blue")
lines(res.ca$col$coord[c(5,1:4),1],res.ca$col$coord[c(5,1:4),2],lwd=2,col="red")
summary(res.ca)
mean(res.ca$eig[,1])  # Kaiser: how many dimensions to retain
# Traditional analysis by contingency tables
prop.table(tt,1);prop.table(table(df$f.tt))
prop.table(tt,2);prop.table(table(df$f.cost))
chisq.test(tt)
res.mca<-MCA(df[,c(vars_dis,vars_res)],quali.sup=c(19,20),quanti.sup=21,ncp=35)
summary(res.mca)
fviz_cos2(res.mca, choice = "var", axes = 1:2, top = 10)
fviz_cos2(res.mca, choice = "var", axes = 3:4, top = 10)
fviz_cos2(res.mca, choice = "ind", axes = 1:2, top = 10)
fviz_cos2(res.mca, choice = "ind", axes = 3:4, top = 10)
fviz_contrib(res.mca, choice = "var", axes = 1:2, top = 10)
fviz_contrib(res.mca, choice = "var", axes = 3:4, top = 10)
fviz_contrib(res.mca, choice = "ind", axes = 1:2, top = 10)
fviz_contrib(res.mca, choice = "ind", axes = 3:4, top = 10)
summary(res.mca,nbelements=50,nbind=0)
fviz_eig(res.mca,ncp=35)
fviz_eig(res.mca, choice = "eigenvalue", addlabels = TRUE)
fviz_eig(res.mca, addlabels = TRUE)
mean(res.mca$eig[,1])
plot(res.mca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(1,2))
plot(res.mca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(3,4))
plot(res.mca,choix=c("ind"), invisible = c("ind"), axes=c(1,2))
plot(res.mca,choix=c("ind"), invisible = c("ind"), axes=c(3,4))
plot.MCA(res.mca,choix=c("var"),axes=c(1,2))
plot.MCA(res.mca,choix=c("var"),axes=c(3,4))
res.mca<-MCA(df[,c(vars_dis,vars_res)],quali.sup=c(19,20),quanti.sup=21,ncp=35)
res.hcpc<-HCPC(res.mca,nb.clust=-1,order=TRUE)
barplot(table(res.hcpc$data.clust$clust))
summary(res.hcpc$data.clust$clust)
res.hcpc$desc.var$test.chi2
res.hcpc$desc.var$category
res.hcpc$desc.var$quanti.var
res.hcpc$desc.var$quanti
res.hcpc$desc.axes$quanti.var
res.hcpc$desc.axes$quanti
res.hcpc$desc.ind$para
res.hcpc$desc.ind$dist
para1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[1]]))
para2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[2]]))
para3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[3]]))
para4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[4]]))
para5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[5]]))
para6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[6]]))
dist1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[1]]))
dist2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[2]]))
dist3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[3]]))
dist4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[4]]))
dist5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[5]]))
dist6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[6]]))
plot(res.pca,label="none",invisible=c("quali","ind.sup"))
plot(res.pca$ind$coord[,1],res.pca$ind$coord[,2],col="grey80",cex=0.5,pch=16)
points(res.pca$ind$coord[para1,1],res.pca$ind$coord[para1,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist1,1],res.pca$ind$coord[dist1,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para2,1],res.pca$ind$coord[para2,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist2,1],res.pca$ind$coord[dist2,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para3,1],res.pca$ind$coord[para3,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist3,1],res.pca$ind$coord[dist3,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para4,1],res.pca$ind$coord[para4,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist4,1],res.pca$ind$coord[dist4,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para5,1],res.pca$ind$coord[para5,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist5,1],res.pca$ind$coord[dist5,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para6,1],res.pca$ind$coord[para6,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist6,1],res.pca$ind$coord[dist6,2],col="orange",cex=2,pch=16)
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[2]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[2]])),]
res.hcpc$call$t$nb.clust
res.hcpc$call$t$within[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$quot[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$inert.gain[1:res.hcpc$call$t$nb.clust]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[res.hcpc$call$t$nb.clust])/res.hcpc$call$t$within[1]
df[c("2"),]
df[c("1"),]
df[c("24"),]
df[c("3"),]
df[c("4"),]
df[c("5"),]
df[c("6"),]
df[c("7"),]
df[c("2589","426", "2556","2664","2668","2521","2527","3242", "1397", "1291")]
df[c("2589","426", "2556","2664","2668","2521","2527","3242", "1397", "1291"),]
df[c("24", "53", "66", "50", "176","74","64", "1", "28", "85"),]
df[c("24", "53", "66", "50", "176","74","64", "1", "28", "85"),]
df[c("24", "53", "66", "50", "176","74","64", "1", "28", "85"),]
df[c("24", "53", "66", "50", "176","74","64", "1", "28", "85"),]
df[c("1855", "2445", "322", "1737", "1057", "3696"),]
df[c("1855", "2445", "322", "1737", "1057", "3696"),]
# Load Required Packages: to be increased over the course
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","chemometrics","mvoutlier","effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2","dplyr","ggmap","ggthemes","knitr","ggpubr", "corrplot")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
# Clear plots
if(!is.null(dev.list())) dev.off()
# Clean workspace
rm(list=ls())
#setwd("C:/Users/carle/Desktop/ADEI2")
#filepath<-"C:/Users/carle/Desktop/ADEI2/"
setwd("~/Desktop/ADEI/Labs/DeliverableII")
df <- read.table("Deliverable1.csv",header=T, sep=",");
vars_dis <- c("VendorID", "Payment_type", "Store_and_fwd_flag",  "RateCodeID", "f.Extra", "f.MTA_tax", "f.Improvement_surcharge", "lpep_pickup_period", "Trip_type", "lpep_pickup_date", "multiouts", "f.espeed", "f.tlenkm", "f.traveltime", "f.distHaversine", "AnyToll", "f.Fare_amount", "f.Passenger_count", "f.Total_amount")
vars_con <- c( "Passenger_count", "tlenkm", "Pickup_longitude", "Pickup_latitude", "Dropoff_longitude", "Dropoff_latitude","Fare_amount", "espeed", "Tip_amount", "Tolls_amount", "lpep_pickup_time", "traveltime", "distHaversine")
for( i in vars_dis){
df[,i] <- as.factor(df[,i])
}
vars_res <- c("AnyTip", "Total_amount")
d1 <- dim(df)[1]
d2 <- dim(df)[2]
df[,d2-1] <- as.factor(df[,d2-1])
res.pca<-PCA(df[,c(1:10,20:(d2-2),d2)],quali.sup=c(1:10),quanti.sup=c(13:16,24), ncp=4, ind.sup = which(df$multiouts==TRUE))
summary(res.pca,nb.dec=2,nbind=1,nbelements=1000,ncp=4)
fviz_eig(res.pca, choice = "eigenvalue", addlabels = TRUE)
fviz_eig(res.pca, addlabels = TRUE)
corrplot(res.pca$var$cos2, is.corr=FALSE)
fviz_cos2(res.pca, choice = "var", axes = 1:2, top = 10)
fviz_cos2(res.pca, choice = "var", axes = 3:4, top = 10)
fviz_cos2(res.pca, choice = "ind", axes = 1:2, top = 10)
fviz_cos2(res.pca, choice = "ind", axes = 3:4, top = 10)
corrplot(res.pca$var$contrib, is.corr=FALSE)
fviz_contrib(res.pca, choice = "var", axes = 1:2, top = 10)
fviz_contrib(res.pca, choice = "var", axes = 3:4, top = 10)
fviz_contrib(res.pca, choice = "ind", axes = 1:2, top = 10)
fviz_contrib(res.pca, choice = "ind", axes = 3:4, top = 10)
plot.PCA(res.pca,choix=c("var"), axes=c(1,2))
plot.PCA(res.pca,choix=c("var"), axes=c(3,4))
corrplot(res.pca$var$coord, is.corr=FALSE)
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"), axes=c(1,2))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"), axes=c(3,4))
corrplot(res.pca$quanti.sup$coord, is.corr=FALSE)
plot.PCA(res.pca,choix=c("var"),invisible=c("var"), axes=c(1,2))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"), axes=c(3,4))
plot.PCA(res.pca,choix=c("ind"), invisible = c("ind", "ind.sup"), axes=c(1,2))
plot.PCA(res.pca,choix=c("ind"), invisible = c("ind", "ind.sup"), axes=c(3,4))
plot(res.pca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(1,2))
plot(res.pca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(3,4))
plot(res.pca,choix=c("ind"),invisible = c("ind", "var", "quali"), axes=c(1,2))
plot(res.pca,choix=c("ind"),invisible = c("ind", "var", "quali"), axes=c(3,4))
res.pca<-PCA(df[,c(1:10,20:(d2-2),d2)],quali.sup=c(1:10),quanti.sup=c(13:16,24), ncp=4, graph= FALSE)
res.hcpc<-HCPC(res.pca,nb.clust = -1,order=TRUE)
df$hcpck<-res.hcpc$data.clust$clust
barplot(table(res.hcpc$data.clust$clust))
summary(res.hcpc$data.clust$clust)
res.hcpc$desc.var$test.chi2
res.hcpc$desc.var$category
res.hcpc$desc.var$quanti.var
res.hcpc$desc.var$quanti
res.hcpc$desc.axes$quanti.var
res.hcpc$desc.axes$quanti
res.hcpc$desc.ind$para
res.hcpc$desc.ind$dist
para1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[1]]))
para2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[2]]))
para3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[3]]))
para4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[4]]))
para5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[5]]))
para6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[6]]))
dist1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[1]]))
dist2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[2]]))
dist3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[3]]))
dist4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[4]]))
dist5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[5]]))
dist6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[6]]))
plot(res.pca,label="none",invisible=c("quali","ind.sup"))
plot(res.pca$ind$coord[,1],res.pca$ind$coord[,2],col="grey80",cex=0.5,pch=16)
points(res.pca$ind$coord[para1,1],res.pca$ind$coord[para1,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist1,1],res.pca$ind$coord[dist1,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para2,1],res.pca$ind$coord[para2,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist2,1],res.pca$ind$coord[dist2,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para3,1],res.pca$ind$coord[para3,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist3,1],res.pca$ind$coord[dist3,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para4,1],res.pca$ind$coord[para4,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist4,1],res.pca$ind$coord[dist4,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para5,1],res.pca$ind$coord[para5,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist5,1],res.pca$ind$coord[dist5,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para6,1],res.pca$ind$coord[para6,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist6,1],res.pca$ind$coord[dist6,2],col="orange",cex=2,pch=16)
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[2]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[2]])),]
res.hcpc$call$t$nb.clust
res.hcpc$call$t$within[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$quot[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$inert.gain[1:res.hcpc$call$t$nb.clust]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[res.hcpc$call$t$nb.clust])/res.hcpc$call$t$within[1]
res.pca<-PCA(df[,c(1:10,20:(d2-2),d2)],quali.sup=c(1:10),quanti.sup=c(13:16,24), ncp=4, graph= FALSE)
ppcc<-res.pca$ind$coord[,1:4]
dist<-dist(ppcc)
kc<-kmeans(dist,6, iter.max = 30, trace=T)
df$claKM<-factor(kc$cluster)
kc$betweenss/kc$totss
i <- which(names(df)=="claKM")
res.cat<-catdes(df,i)
res.cat$quanti.var
res.cat$quanti
res.cat$test.chi2
res.cat$category
df$hcpck<-factor(df$hcpck,labels=paste("kHP-",1:6))
df$claKM<-factor(df$claKM,levels=c(3,6,2,1,5,4),labels=c("kKM-3","kKM-6","kKM-2","kKM-1","kKM-5","kKM-4"))
tt<-table(df$hcpck,df$claKM)
tt
sum(diag(tt)/sum(tt))
tt<-table(df[,c("f.Total_amount","lpep_pickup_period")])
tt
chisq.test(tt)
res.ca<-CA(tt)
#lines(res.ca$row$coord[,1],res.ca$row$coord[,2],lwd=2,col="blue")
summary(res.ca,dig=2)
names(res.ca)
fviz_eig(res.ca)
fviz_ca_biplot(res.ca,repel=TRUE)+theme_bw()
tt<-table(df[,c("f.Total_amount","f.traveltime")])
tt
chisq.test(tt)
res.ca<-CA(tt)
plot(res.ca$row$coord[,1],res.ca$row$coord[,2],pch=19,col="blue",xlim=c(-1,3),ylim=c(-1,3),xlab="Axis 1",ylab="Axis 2",main="CA f.traveltime vs f.Total_amount")
points(res.ca$col$coord[,1],res.ca$col$coord[,2],pch=19,lwd=2,col="red")
#text(res.ca$row$coord[c(1,7,2,3,4,5,6),1],res.ca$row$coord[c(1,7,2,3,4,5,6),2],col="blue",labels=levels(df$f.traveltime))
#text(res.ca$col$coord[c(3,1,2),1],res.ca$col$coord[c(3,1,2),2],col="red",labels=levels(df$f.Total_amount))
lines(res.ca$row$coord[c(1,7,2:6),1],res.ca$row$coord[c(1,7,2:6),2],lwd=2,col="blue")
lines(res.ca$col$coord[c(5,1:4),1],res.ca$col$coord[c(5,1:4),2],lwd=2,col="red")
summary(res.ca)
mean(res.ca$eig[,1])  # Kaiser: how many dimensions to retain
# Traditional analysis by contingency tables
prop.table(tt,1);prop.table(table(df$f.tt))
prop.table(tt,2);prop.table(table(df$f.cost))
chisq.test(tt)
res.mca<-MCA(df[,c(vars_dis,vars_res)],quali.sup=c(19,20),quanti.sup=21,ncp=35)
summary(res.mca)
fviz_cos2(res.mca, choice = "var", axes = 1:2, top = 10)
fviz_cos2(res.mca, choice = "var", axes = 3:4, top = 10)
fviz_cos2(res.mca, choice = "ind", axes = 1:2, top = 10)
fviz_cos2(res.mca, choice = "ind", axes = 3:4, top = 10)
fviz_contrib(res.mca, choice = "var", axes = 1:2, top = 10)
fviz_contrib(res.mca, choice = "var", axes = 3:4, top = 10)
fviz_contrib(res.mca, choice = "ind", axes = 1:2, top = 10)
fviz_contrib(res.mca, choice = "ind", axes = 3:4, top = 10)
summary(res.mca,nbelements=50,nbind=0)
fviz_eig(res.mca,ncp=35)
fviz_eig(res.mca, choice = "eigenvalue", addlabels = TRUE)
fviz_eig(res.mca, addlabels = TRUE)
mean(res.mca$eig[,1])
plot(res.mca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(1,2))
plot(res.mca,choix=c("ind"),invisible = c("ind.sup", "var", "quali"),select="contrib 10", axes=c(3,4))
plot(res.mca,choix=c("ind"), invisible = c("ind"), axes=c(1,2))
plot(res.mca,choix=c("ind"), invisible = c("ind"), axes=c(3,4))
plot.MCA(res.mca,choix=c("var"),axes=c(1,2))
plot.MCA(res.mca,choix=c("var"),axes=c(3,4))
res.mca<-MCA(df[,c(vars_dis,vars_res)],quali.sup=c(19,20),quanti.sup=21,ncp=35)
res.hcpc<-HCPC(res.mca,nb.clust=-1,order=TRUE)
barplot(table(res.hcpc$data.clust$clust))
summary(res.hcpc$data.clust$clust)
res.hcpc$desc.var$test.chi2
res.hcpc$desc.var$category
res.hcpc$desc.var$quanti.var
res.hcpc$desc.var$quanti
res.hcpc$desc.axes$quanti.var
res.hcpc$desc.axes$quanti
res.hcpc$desc.ind$para
res.hcpc$desc.ind$dist
para1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[1]]))
para2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[2]]))
para3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[3]]))
para4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[4]]))
para5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[5]]))
para6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$para[[6]]))
dist1<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[1]]))
dist2<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[2]]))
dist3<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[3]]))
dist4<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[4]]))
dist5<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[5]]))
dist6<-which(rownames(res.pca$ind$coord)%in%names(res.hcpc$desc.ind$dist[[6]]))
plot(res.pca,label="none",invisible=c("quali","ind.sup"))
plot(res.pca$ind$coord[,1],res.pca$ind$coord[,2],col="grey80",cex=0.5,pch=16)
points(res.pca$ind$coord[para1,1],res.pca$ind$coord[para1,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist1,1],res.pca$ind$coord[dist1,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para2,1],res.pca$ind$coord[para2,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist2,1],res.pca$ind$coord[dist2,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para3,1],res.pca$ind$coord[para3,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist3,1],res.pca$ind$coord[dist3,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para4,1],res.pca$ind$coord[para4,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist4,1],res.pca$ind$coord[dist4,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para5,1],res.pca$ind$coord[para5,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist5,1],res.pca$ind$coord[dist5,2],col="orange",cex=2,pch=16)
points(res.pca$ind$coord[para6,1],res.pca$ind$coord[para6,2],col="blue",cex=2,pch=16)
points(res.pca$ind$coord[dist6,1],res.pca$ind$coord[dist6,2],col="orange",cex=2,pch=16)
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[1]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$para[[2]])),]
res.hcpc$data.clust[which(rownames(res.hcpc$data.clust)%in%names(res.hcpc$desc.ind$dist[[2]])),]
res.hcpc$call$t$nb.clust
res.hcpc$call$t$within[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$quot[1:res.hcpc$call$t$nb.clust]
res.hcpc$call$t$inert.gain[1:res.hcpc$call$t$nb.clust]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[res.hcpc$call$t$nb.clust])/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[35)/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[35])/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[100])/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[1000])/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[5000])/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[500])/res.hcpc$call$t$within[1]
(res.hcpc$call$t$within[1]-res.hcpc$call$t$within[200])/res.hcpc$call$t$within[1]
(2161+263+0+50)/(661+2161+295+17+263+6+12+9+728+462+44+205+50+6+81)
df$hcpck<-factor(df$hcpck,labels=paste("kHP-",1:6))
